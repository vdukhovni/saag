<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Opportunistic Security: Some Protection Most of the Time</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Background"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 A New Perspective"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Opportunistic Security Design Principles"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Example: Opportunistic TLS in SMTP"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Operational Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="8 References"/>
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.4 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Dukhovni, V." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-dukhovni-opportunistic-security-05" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-10-27" />
  <meta name="dct.abstract" content="This document defines the concept &quot;Opportunistic Security&quot; in the context of communications protocols.  Protocol designs based on Opportunistic Security use encryption even when authentication is not available, and use authentication when possible, thereby removing barriers to the widespread use of encryption on the Internet.  " />
  <meta name="description" content="This document defines the concept &quot;Opportunistic Security&quot; in the context of communications protocols.  Protocol designs based on Opportunistic Security use encryption even when authentication is not available, and use authentication when possible, thereby removing barriers to the widespread use of encryption on the Internet.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">V. Dukhovni</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Two Sigma</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">October 27, 2014</td>
</tr>
<tr>
  <td class="left">Expires: April 30, 2015</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Opportunistic Security: Some Protection Most of the Time<br />
  <span class="filename">draft-dukhovni-opportunistic-security-05</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document defines the concept "Opportunistic Security" in the context of communications protocols.  Protocol designs based on Opportunistic Security use encryption even when authentication is not available, and use authentication when possible, thereby removing barriers to the widespread use of encryption on the Internet.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 30, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Background</a></li>
<li>1.2.   <a href="#rfc.section.1.2">A New Perspective</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Opportunistic Security Design Principles</a></li>
<li>4.   <a href="#rfc.section.4">Example: Opportunistic TLS in SMTP</a></li>
<li>5.   <a href="#rfc.section.5">Operational Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a></li>
<li>8.   <a href="#rfc.references">References</a></li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Background</h1>
<p id="rfc.section.1.1.p.1">Historically, Internet security protocols have emphasized comprehensive "all or nothing" cryptographic protection against both passive and active attacks.  With each peer, such a protocol achieves either full protection or else total failure to communicate (hard fail).  As a result, operators often disable these security protocols when users have difficulty connecting, thereby degrading all communications to cleartext transmission.  </p>
<p id="rfc.section.1.1.p.2">Protection against active attacks requires authentication. The ability to authenticate any potential peer on the Internet requires an authentication mechanism that encompasses all such peers.  No IETF standard for authentication scales as needed and has been deployed widely enough to meet this requirement.  </p>
<p id="rfc.section.1.1.p.3">The Public Key Infrastructure (PKI) model employed by browsers to authenticate web servers (often called the "Web PKI") imposes cost and management burdens that have limited its use.  With so many Certification Authorities (CAs), not all of which everyone is willing to trust, the communicating parties don't always agree on a mutually trusted CA.  Without a mutually trusted CA, authentication fails, leading to communications failure in protocols that mandate authentication.  These issues are compounded by operational difficulties.  For example, a common problem is for site operators to forget to perform timely renewal of expiring certificates.  In Web PKI interactive applications, security warnings are all too frequent, and end-users learn to actively ignore security problems, or site administrators decide that the maintenance cost is not worth the benefit so they provide a cleartext-only service to their users.  </p>
<p id="rfc.section.1.1.p.4">The trust-on-first-use (TOFU) authentication approach assumes that an unauthenticated public key obtained on first contact (and retained for future use) will be good enough to secure future communication.  TOFU-based protocols do not protect against an attacker who can hijack the first contact communication and require more care from the end-user when systems update their cryptographic keys.  TOFU can make it difficult to distinguish routine key management from a malicious attack.  </p>
<p id="rfc.section.1.1.p.5">DNS-Based Authentication of Named Entities (DANE <a href="#RFC6698">[RFC6698]</a>) defines a way to distribute public keys bound to DNS names.  It can provide an alternative to the Web PKI.  DANE needs to be used in conjunction with DNSSEC <a href="#RFC4033">[RFC4033]</a>.  At the time of writing, DNSSEC is not sufficiently widely deployed to allow DANE to authenticate all potential peers.  Protocols that mandate authenticated communication cannot yet generally do so via DANE (at the time of writing).  </p>
<p id="rfc.section.1.1.p.6">The lack of a global key management system means that for many protocols, only a minority of communications sessions can be predictably authenticated.  When protocols only offer a choice between authenticated-and-encrypted communication, or no protection, the result is that most traffic is sent in cleartext.  The fact that most traffic is not encrypted makes pervasive monitoring easier by making it cost-effective, or at least not cost-prohibitive (see <a href="#RFC7258">[RFC7258]</a> for more detail).  </p>
<p id="rfc.section.1.1.p.7">For encryption to be used more broadly, authentication needs to be optional.  The use of encryption defends against pervasive monitoring and other passive attacks.  Even unauthenticated, encrypted communication (defined below) is preferable to cleartext.  </p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> A New Perspective</h1>
<p id="rfc.section.1.2.p.1">This document describes a change of perspective.  Until now, the protocol designer has viewed protection against both passive and active attacks as the default, and anything short of that as "degraded security" or a "fallback".  The new viewpoint is that without specific knowledge of peer capabilities (or explicit configuration or direct request of the application), the default protection is no protection, and anything more than that is an improvement.  </p>
<p id="rfc.section.1.2.p.2">"Opportunistic Security" (OS) is defined as the use of cleartext as the baseline communication security policy, with encryption and authentication negotiated and applied to the communication when available.  </p>
<p id="rfc.section.1.2.p.3">Cleartext, not comprehensive protection, is the default baseline.  An OS protocol is not falling back from comprehensive protection when that protection is not supported by all peers; rather, OS protocols aim to use the maximum protection that is available.  (At some point in time for a particular application or protocol all but a negligible fraction of peers might support encryption.  At that time, the baseline security might be raised from cleartext to always require encryption, and only authentication would have to be done opportunistically.) </p>
<p id="rfc.section.1.2.p.4">To achieve widespread adoption, OS must support incremental deployment.  Incremental deployment implies that security capabilities will vary from peer to peer, perhaps for a very long time.  OS protocols will attempt to establish encrypted communication whenever both parties are capable of such, and authenticated communication if that is also possible.  Thus, use of an OS protocol may yield communication that is authenticated and encrypted, unauthenticated but encrypted, or cleartext.  This last outcome will occur if not all parties to a communication support encryption (or if an active attack makes it appear that this is the case).  </p>
<p id="rfc.section.1.2.p.5">When less than complete protection is negotiated, there is no need to prompt the user with "your security may be degraded, please click OK" dialogs.  The negotiated protection is as good as can be expected.  Even if not comprehensive, it is often better than the traditional outcome of either "no protection" or "communications failure".  </p>
<p id="rfc.section.1.2.p.6">OS is not intended as a substitute for authenticated, encrypted communication when such communication is already mandated by policy (that is, by configuration or direct request of the application) or is otherwise required to access a particular resource. In essence, OS is employed when one might otherwise settle for cleartext.  OS protocols never preempt explicit security policies. A security administrator may specify security policies that override OS.  For example, a policy might require authenticated, encrypted communication, in contrast to the default OS security policy.  </p>
<p id="rfc.section.1.2.p.7">In this document, the word "opportunistic" carries a positive connotation.  Based on advertised peer capabilities, an OS protocol uses as much protection as possible.  The adjective "opportunistic" applies to the adaptive choice of security mechanisms peer by peer.  Once that choice is made for a given peer, OS looks rather similar to other designs that happen to use the same set of mechanisms.  </p>
<p id="rfc.section.1.2.p.8">The remainder of this document provides definitions of important terms, sets out the OS design principles, and provides an example of an OS design in the context of communication between mail relays.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#sec_terminology" id="sec_terminology">Terminology</a></h1>
<p/>

<dl>
  <dt>Trust on First Use (TOFU):</dt>
  <dd style="margin-left: 8">In a protocol, TOFU calls for accepting and storing a public key or credential associated with an asserted identity, without authenticating that assertion.  Subsequent communication that is authenticated using the cached key or credential is secure against an MiTM attack, if such an attack did not succeed during the vulnerable initial communication.  The SSH protocol <a href="#RFC4251">[RFC4251]</a> in its commonly deployed form makes use of TOFU.  The phrase "leap of faith" (LoF, <a href="#RFC4949">[RFC4949]</a>) is sometimes used as a synonym.  </dd>
  <dt>Authenticated, encrypted communication:</dt>
  <dd style="margin-left: 8">Encrypted communication using a session establishment method in which at least the initiator (or client) authenticates the identity of the acceptor (or server).  This is required to protect against both passive and active attacks.  Mutual authentication, in which the server also authenticates the client, plays a role in mitigating active attacks when the client and server roles change in the course of a single session. </dd>
  <dt>Unauthenticated, encrypted communication:</dt>
  <dd style="margin-left: 8">Encrypted communication using a session establishment method that does not authenticate the identities of the peers.  In typical usage, this means that the initiator (client) has not verified the identity of the target (server), making MiTM attacks possible.  </dd>
  <dt>Perfect Forward Secrecy (PFS):</dt>
  <dd style="margin-left: 8">As defined in <a href="#RFC4949">[RFC4949]</a>.  </dd>
  <dt>Man-in-the-Middle (MiTM) attack:</dt>
  <dd style="margin-left: 8">As defined in <a href="#RFC4949">[RFC4949]</a>.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Opportunistic Security Design Principles</h1>
<p id="rfc.section.3.p.1">OS provides a near-term approach to counter passive attacks by removing barriers to the widespread use of encryption.  OS offers an incremental path to authenticated, encrypted communication in the future, as suitable authentication technologies are deployed.  OS promotes the following design principles: </p>
<p/>

<dl>
  <dt>Coexist with explicit policy:</dt>
  <dd style="margin-left: 8">Explicit security policies preempt OS.  Opportunistic security never displaces or preempts explicit policy.  Many applications and types of data are too sensitive to use OS, and more traditional security designs are appropriate in such cases.  </dd>
  <dt>Prioritize communication:</dt>
  <dd style="margin-left: 8">The primary goal of OS is to not impede communication while maximizing the deployment of usable security.  OS protocols need to be deployable incrementally, with each peer configured independently by its administrator or user.  With OS, communication is still possible even when some peers support encryption or authentication and others do not. </dd>
  <dt>Maximize security peer by peer:</dt>
  <dd style="margin-left: 8">OS protocols use encryption when it is mutually supported.  OS protocols enforce peer authentication when an authenticated out-of-band channel is available to provide the requisite keys or credentials.  In general, communication should be at least encrypted.  OS should employ Perfect Forward Secrecy (PFS) wherever possible in order to protect previously recorded encrypted communication from decryption even after a compromise of long-term keys.  </dd>
  <dt>No misrepresentation of security:</dt>
  <dd style="margin-left: 8">Unauthenticated, encrypted communication must not be misrepresented to users or in application logs of non-interactive applications as equivalent to authenticated, encrypted communication.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.p.3">An OS protocol first determines the capabilities of the peer with which it is attempting to communicate.  Peer capabilities may be discovered by out-of-band or in-band means.  (Out-of-band mechanisms include the use of DANE records or cached keys or credentials acquired via TOFU. In-band determination implies negotiation between peers.)  The capability determination phase may indicate that the peer supports authenticated, encrypted communication; unauthenticated, encrypted communication; or only cleartext communication.  </p>
<p id="rfc.section.3.p.4">Encryption is used to mitigate the risk of passive monitoring attacks, while authentication is used to mitigate the risk of active man-in-the-middle (MiTM) attacks.  When encryption capability is advertised over an insecure channel, MiTM downgrade attacks to cleartext may be possible.  Since encryption without authentication only mitigates passive attacks, this risk is consistent with the expected level of protection.  For authentication to protect against MiTM attacks the peer capability advertisements that convey support for authentication need to be over an out-of-band authenticated channel that is itself resistant to MiTM attack.  </p>
<p id="rfc.section.3.p.5">Opportunistic security protocols may hard-fail with peers for which a security capability fails to function as advertised.  Security services that work reliably (when not under attack) are more likely to be deployed and enabled by default.  It is vital that the capabilities advertised for an OS-compatible peer match the deployed reality.  Otherwise, OS systems will detect such a broken deployment as an active attack and communication may fail.  This might mean that advertised peer capabilities are further filtered to consider only those capabilities that are sufficiently operationally reliable.  Capabilities that can't be expected to work reliably should be treated by an OS protocol as "not present" or "undefined".  </p>
<p id="rfc.section.3.p.6">With unauthenticated, encrypted communication, OS protocols may employ more liberal settings than would be best-practice when security is mandated by policy.  Some legacy systems support encryption, but implement only outdated algorithms or protocol versions.  Compatibility with these systems avoids the need to resort to cleartext fallback.  </p>
<p id="rfc.section.3.p.7">For greater assurance of channel security, an OS protocol may enforce more stringent cryptographic parameters when the session is authenticated.  For example, the set of enabled Transport Layer Security (TLS <a href="#RFC5246">[RFC5246]</a>) cipher suites might exclude deprecated algorithms that would be tolerated with unauthenticated, encrypted communication.  </p>
<p id="rfc.section.3.p.8">OS protocols should produce authenticated, encrypted communication when authentication of the peer is "expected".  Here, "expected" means a determination via a downgrade-resistant method that authentication of that peer is expected to work.  Downgrade-resistant methods include: validated DANE DNS records, existing TOFU identity information, and manual configuration.  Such use of authentication is "opportunistic", in that it is performed when possible, on a per-session basis.  </p>
<p id="rfc.section.3.p.9">When communicating with a peer that supports encryption but not authentication, any authentication checks enabled by default must be disabled or configured to soft-fail in order to avoid unnecessary communications failure or needless downgrade to cleartext.  </p>
<p id="rfc.section.3.p.10">Cleartext is supported for backwards compatibility with systems already deployed.  Even when cleartext needs to be supported, protocol designs based on Opportunistic Security prefer to encrypt, employing cleartext only with peers that do not appear to be encryption capable.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Example: Opportunistic TLS in SMTP</h1>
<p id="rfc.section.4.p.1">Most Message Transfer Agents (MTAs, <a href="#RFC5598">[RFC5598]</a>) support the STARTTLS (<a href="#RFC3207">[RFC3207]</a>) ESMTP extension.  MTAs acting as SMTP (<a href="#RFC5321">[RFC5321]</a>) clients generally support cleartext transmission of email.  They negotiate TLS encryption when the SMTP server announces STARTTLS support.  Since the initial ESMTP negotiation is not cryptographically protected, the STARTTLS advertisement is vulnerable to MiTM downgrade attacks.  </p>
<p id="rfc.section.4.p.2">Recent reports from a number of large providers (e.g., <a href="#fb-starttls">[fb-starttls]</a> and <a href="#goog-starttls">[goog-starttls]</a>) suggest that the  majority of SMTP email transmission on the Internet is now encrypted, and the trend is toward increasing adoption.  </p>
<p id="rfc.section.4.p.3">Various MTAs that advertise STARTTLS exhibit interoperability problems in their implementations.  As a work-around, it is common for a client MTA to fall back to cleartext when the TLS handshake fails, or when TLS fails during message transmission.  This is a reasonable trade-off, since STARTTLS only protects against passive attacks.  In the absence of an active attack TLS failures are generally one of the known interoperability problems.  </p>
<p id="rfc.section.4.p.4">Some client MTAs employing STARTTLS abandon the TLS handshake when the server MTA fails authentication, and immediately start a cleartext connection.  Other MTAs have been observed to accept unverified self-signed certificates, but not expired certificates; again falling back to cleartext.  These and similar behaviors are NOT consistent with OS principles, since they needlessly fall back to cleartext when encryption is clearly possible.  </p>
<p id="rfc.section.4.p.5">Protection against active attacks for SMTP is described in <a href="#I-D.ietf-dane-smtp-with-dane">[I-D.ietf-dane-smtp-with-dane]</a>.  That document introduces the terms "Opportunistic TLS" and "Opportunistic DANE TLS", and is consistent with the OS design principles defined in this document.  With "Opportunistic DANE TLS", authenticated, encrypted communication is enforced with peers for which appropriate DANE records are present.  For the remaining peers, "Opportunistic TLS"  is employed as before.  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> Operational Considerations</h1>
<p id="rfc.section.5.p.1">OS protocol designs should minimize the possibility of failure of negotiated security mechanisms.  OS protocols may need to employ "fallback", to work-around a failure of a security mechanisms that is found in practice to encounter interoperability problems.  The choice to implement or enable fallback should only be made in response to significant operational obstacles.  </p>
<p id="rfc.section.5.p.2">When protection only against passive attacks is negotiated over a channel vulnerable to active downgrade attacks, and the use of encryption fails, a protocol might elect non-intrusive fallback to cleartext.  Failure to encrypt may be more often a symptom of an interoperability problem than an active attack.  In such a situation occasional fallback to cleartext may serve the greater good.  Even though some traffic is sent in the clear, the alternative is to ask the administrator or user to manually work-around such interoperability problems.  If the incidence of such problems is non-negligible, the user or administrator might find it more expedient to just disable Opportunistic Security.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#sec_security" id="sec_security">Security Considerations</a></h1>
<p id="rfc.section.6.p.1">OS supports communication that is authenticated and encrypted, unauthenticated and encrypted, or cleartext.  And yet the security provided to communicating peers is not reduced by the use of OS because the default OS policy employs the best security services available based on the capabilities of the peers, and because explicit security policies take precedence over the default OS policy.  OS is an improvement over the status quo; it provides better security than the alternative of providing no security services when authentication is not possible (and not strictly required).  </p>
<p id="rfc.section.6.p.2">While the use of OS is preempted by a non-OS explicit policy, such a non-OS policy can be counter-productive when it demands more than many peers can in fact deliver.  Non-OS policy should be used with care, lest users find it too restrictive and act to disable security entirely.  </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.7.p.1">I would like to thank Dave Crocker, Peter Duchovni, Paul Hoffman, Benjamin Kaduk, Steve Kent, Scott Kitterman, Pete Resnick, Martin Thomson, Nico Williams, Paul Wouters and Stephen Farrell for their many helpful suggestions and support.  </p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC3207">[RFC3207]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a>, "<a href="http://tools.ietf.org/html/rfc3207">SMTP Service Extension for Secure SMTP over Transport Layer Security</a>", RFC 3207, February 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4033">[RFC4033]</b>
      </td>
      <td class="top"><a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>", RFC 4033, March 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4251">[RFC4251]</b>
      </td>
      <td class="top"><a>Ylonen, T.</a> and <a>C. Lonvick</a>, "<a href="http://tools.ietf.org/html/rfc4251">The Secure Shell (SSH) Protocol Architecture</a>", RFC 4251, January 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5321">[RFC5321]</b>
      </td>
      <td class="top"><a>Klensin, J.</a>, "<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>", RFC 5321, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6698">[RFC6698]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a> and <a>J. Schlyter</a>, "<a href="http://tools.ietf.org/html/rfc6698">The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA</a>", RFC 6698, August 2012.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-dane-smtp-with-dane">[I-D.ietf-dane-smtp-with-dane]</b>
      </td>
      <td class="top"><a>Dukhovni, V.</a> and <a>W. Hardaker</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dane-smtp-with-dane-12">SMTP security via opportunistic DANE TLS</a>", Internet-Draft draft-ietf-dane-smtp-with-dane-12, August 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4949">[RFC4949]</b>
      </td>
      <td class="top"><a>Shirey, R.</a>, "<a href="http://tools.ietf.org/html/rfc4949">Internet Security Glossary, Version 2</a>", RFC 4949, August 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5598">[RFC5598]</b>
      </td>
      <td class="top"><a>Crocker, D.</a>, "<a href="http://tools.ietf.org/html/rfc5598">Internet Mail Architecture</a>", RFC 5598, July 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7258">[RFC7258]</b>
      </td>
      <td class="top"><a>Farrell, S.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc7258">Pervasive Monitoring Is an Attack</a>", BCP 188, RFC 7258, May 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="fb-starttls">[fb-starttls]</b>
      </td>
      <td class="top"><a>Facebook</a>, "<a href="https://www.facebook.com/notes/protect-the-graph/the-current-state-of-smtp-starttls-deployment/1453015901605223">The Current State of SMTP STARTTLS Deployment</a>", May 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="goog-starttls">[goog-starttls]</b>
      </td>
      <td class="top"><a>Google</a>, "<a href="https://www.google.com/transparencyreport/saferemail/">Safer email - Transparency Report - Google</a>", June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Viktor Dukhovni</span> 
	  <span class="n hidden">
		<span class="family-name">Dukhovni</span>
	  </span>
	</span>
	<span class="org vcardline">Two Sigma</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf-dane@dukhovni.org">ietf-dane@dukhovni.org</a></span>

  </address>
</div>

</body>
</html>
